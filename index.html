<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>qrcode</title>
<style>
*{margin:0;padding:0;}
</style>
</head>
<body>
<video id="video" width="600" height="600" autoplay></video>
<canvas id="canvas" width="600" height="600"></canvas>
</body>
<script type="text/javascript" src="media.js"></script>
<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="bitMatrix.js"></script>
<script type="text/javascript" src="preProcess.js"></script>
<script type="text/javascript" src="pattern.js"></script>
<script type="text/javascript" src="findPattern.js"></script>
<script type="text/javascript" src="perspectiveTransform.js"></script>
<script type="text/javascript" src="version.js"></script>
<script type="text/javascript" src="detector.js"></script>
<script type="text/javascript" src="bitSource.js"></script>
<script type="text/javascript">
var video = document.getElementById('video');
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
media.init(video, canvas, {
	scale : 0.3,
	onSnapshot : progress
});

var raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;

var finded =  false;
function progress(canvas){
	if(finded) return;
	raf(function(){
		var imgMatrix = new preProcess(ctx.getImageData(0, 0, canvas.width, canvas.height));
		var patternInfo = new FindPattern(imgMatrix).find();
		if(patternInfo){
			ctx.fillStyle = "rgb(200,0,0)";
			ctx.arc(patternInfo.topLeft.x, patternInfo.topLeft.y, 5, 0, Math.PI*2, true);
			ctx.arc(patternInfo.topRight.x, patternInfo.topRight.y, 5, 0, Math.PI*2, true);
			ctx.arc(patternInfo.bottomLeft.x, patternInfo.bottomLeft.y, 5, 0, Math.PI*2, true);
	        ctx.fill();
		}
		var qrMatrix = new Detector(imgMatrix, patternInfo).process();
		finded = true;
	})
} 
</script>
</html>
</html>